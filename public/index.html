<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VisionForge AI Suite</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: #111827; color: #f9fafb; margin: 0;
      min-height: 100vh; display: flex; flex-direction: column;
    }
    .header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 18px 30px 12px 22px;
      background: #111827;
      border-bottom: 1px solid #222b3a;
      min-height: 54px;
      position: sticky; top: 0; z-index: 10;
    }
    .header-left {
      display: flex; align-items: center; gap: 13px;
    }
    .logo-custom {
      width: 34px; height: 34px;
      background: linear-gradient(135deg,#3b82f6,#6366f1);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 2px 8px #3b82f655;
    }
    .logo-custom svg { width: 18px; height: 18px;}
    .logo-text { font-size: 1.25rem; font-weight: 700; color: #f3f6fd; letter-spacing: 0.4px;}
    .header-right { position: relative; }
    .menu-btn {
      width: 38px; height: 38px; background: none; border: none;
      display: flex; flex-direction: column; justify-content: center; gap: 7px; cursor: pointer;
      border-radius: 0.7rem; transition: background .13s;
      box-shadow: 0 2px 12px 0 #1d355750;
    }
    .menu-btn span {
      display: block; width: 23px; height: 3.2px; background: #f3f6fd; border-radius: 2px;
    }
    .menu-dropdown {
      display: none; position: absolute; top: 42px; right: 0; background: #222b3a;
      border: 1px solid #374151; box-shadow: 0 2px 8px #11182744;
      border-radius: 0.7rem; min-width: 140px; z-index: 99; padding: 8px 0;
    }
    .menu-dropdown.show { display: block;}
    .menu-dropdown a {
      display: block;
      padding: 5px 20px;
      color: #70a1ff;
      text-decoration: none;
      font-weight: 500;
      font-size: 1rem;
      border-radius: 0.4rem;
      line-height: 1.5;
      transition: background .15s, color .15s;
      margin: 0;
    }
    .menu-dropdown a:not(:last-child) {
      margin-bottom: 2px;
    }
    .menu-dropdown a:hover {
      background: #232d47;
      color: #fff;
    }
    .main { flex: 1; display: flex; align-items: center; justify-content: center; flex-direction: column;}
    .box {
      background: #1f2937; border: 1px solid #374151; border-radius: 1rem;
      box-shadow: 0 12px 32px 0 rgba(30,41,59,0.22);
      padding: 2rem; width: 100%; max-width: 460px; margin-bottom: 2rem;
    }
    h1 {
      margin-bottom: 1rem; font-size: 2rem; font-weight: 700;
      background: linear-gradient(90deg,#3b82f6,#6366f1);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      text-align: center;
    }
    .upload { margin-bottom: 1rem; }
    #preview {
      display: none; max-width: 100%; max-height: 250px; margin: 0 auto 1rem;
      border-radius: 0.8rem; border: 1px solid #374151;
    }
    input[type="file"] { color: #f9fafb; margin-bottom: .8rem; background: transparent; }
    .actions { display: flex; gap: 1rem; margin-bottom: 1rem; }
    button {
      flex:1; background: linear-gradient(90deg,#3b82f6,#6366f1);
      color: #fff; border: none; border-radius: .7rem;
      padding: .7rem 0; font-size: 1rem; font-weight: 600;
      cursor: pointer; transition: opacity .25s;
    }
    button:hover:not(:disabled) { opacity: .93; }
    button:disabled { background: #222d3a; color: #b3b8c1; cursor: not-allowed; }
    .result { display: none; text-align: center; min-height: 300px;}
    .result img {
      max-width: 100%; max-height: 310px; border-radius: .7rem; border: 1px solid #374151;
      box-shadow: 0 2px 12px 0 #18181b60; margin-bottom: 1rem;
    }
    .result-controls { margin-top: 1rem; display: flex; flex-direction: column; gap: 1rem; align-items: center;}
    .result-controls a,
    .result-controls button {
      background: linear-gradient(90deg,#3b82f6,#6366f1);
      color: #fff;
      border: none;
      padding: .75rem 1.6rem;
      border-radius: .6rem;
      font-size: 1rem;
      font-weight: 700;
      text-decoration: none;
      margin: 0;
      transition: opacity .25s;
      display: inline-block;
    }
    .result-controls a:hover,
    .result-controls button:hover {
      opacity: .93;
      background: linear-gradient(90deg,#60a5fa,#818cf8);
    }
    .toast {
      position: fixed; bottom: 36px; left: 50%; transform: translateX(-50%);
      background: #18181b; color: #fff; border-radius: .8rem; padding: .8rem 1.4rem;
      z-index: 999; display: none; font-size: 1rem; font-weight: 500;
    }
    .loading {
      display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
      background: #111827; z-index: 99999;
      justify-content: center; align-items: center; flex-direction: column;
    }
    .loader { width: 80px; height: 80px; margin-bottom: 1.5rem; }
    .loading-text { font-size: 1.5rem; font-weight: 700; color: #f9fafb; text-align: center;}
    .footer { margin-top: auto; text-align: center; color: #9ca3af; font-size: .98rem; padding-bottom: 2rem;}
    @media (max-width:600px) {
      .header {padding: 10px 6px;}
      .box { max-width: 99vw; padding: 1rem 0.2rem;}
      h1, .loading-text { font-size: 1.2rem; }
    }
  </style>
</head>
<body>
  <!-- HEADER BAR -->
  <div class="header">
    <div class="header-left">
      <div class="logo-custom">
        <!-- Bebas ganti SVG icon -->
        <svg fill="none" viewBox="0 0 20 20"><circle cx="10" cy="10" r="8" stroke="#fff" stroke-width="2"/><circle cx="10" cy="10" r="3" fill="#fff" opacity="0.6"/></svg>
      </div>
      <span class="logo-text">VisionForge</span>
    </div>
    <div class="header-right">
      <button id="menu-btn" class="menu-btn" aria-label="Menu">
        <span></span><span></span><span></span>
      </button>
      <div id="menu-dropdown" class="menu-dropdown">
        <a href="https://instagram.com/dtyarmdnir_" target="_blank" rel="noopener">Contact Support</a>
        <a href="https://github.com/Xdit133/remove-bg.git" target="_blank" rel="noopener">Source on GitHub</a>
      </div>
    </div>
  </div>

  <!-- MAIN CONTENT -->
  <div class="loading" id="loading">
    <svg class="loader" viewBox="0 0 50 50">
      <circle cx="25" cy="25" r="20" fill="none" stroke="#2d3748" stroke-width="7"></circle>
      <circle cx="25" cy="25" r="20" fill="none" stroke="#6366f1" stroke-width="7"
        stroke-linecap="round" stroke-dasharray="100" stroke-dashoffset="75"
        style="transform-origin:center;animation:spin 0.7s linear infinite;"></circle>
      <style>@keyframes spin {100% {transform:rotate(360deg);}}</style>
    </svg>
    <div class="loading-text" id="load-text">Processing image...</div>
  </div>
  <div class="main">
    <div class="box" id="form-box">
      <h1>VisionForge AI Suite</h1>
      <div class="upload">
        <input type="file" id="image" accept="image/*">
        <img id="preview" />
      </div>
      <div class="actions">
        <button id="remove-bg" disabled>Remove Background</button>
      </div>
    </div>
    <div class="box result" id="result">
      <img id="out-img" src="" alt="Hasil" style="display:none;">
      <div class="result-controls" style="display:none;">
        <a id="download" href="#" download>Download</a>
        <button id="reset">Other Image Processes</button>
      </div>
    </div>
    <div id="toast" class="toast"></div>
  </div>
  <footer class="footer">Made with Node.js & Python</footer>
  <script>
    // MENU TITIK TIGA
    const menuBtn = document.getElementById('menu-btn');
    const menuDropdown = document.getElementById('menu-dropdown');
    menuBtn.onclick = e => {
      e.stopPropagation();
      menuDropdown.classList.toggle('show');
    };
    window.onclick = () => menuDropdown.classList.remove('show');
    window.onkeydown = e => { if(e.key==='Escape') menuDropdown.classList.remove('show'); };

    // LOGIC UTAMA
    const image = document.getElementById('image');
    const preview = document.getElementById('preview');
    const removeBg = document.getElementById('remove-bg');
    const loading = document.getElementById('loading');
    const loadText = document.getElementById('load-text');
    const result = document.getElementById('result');
    const outImg = document.getElementById('out-img');
    const resultControls = document.querySelector('.result-controls');
    const download = document.getElementById('download');
    const resetBtn = document.getElementById('reset');
    const formBox = document.getElementById('form-box');
    const toast = document.getElementById('toast');
    let fileObj = null;

    function resetInput() {
      image.value = '';
      preview.style.display = 'none';
    }

    image.addEventListener('change', () => {
      fileObj = image.files[0];
      if (fileObj && fileObj.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = e => {
          preview.src = e.target.result;
          preview.style.display = 'block';
        };
        reader.readAsDataURL(fileObj);
        removeBg.disabled = false;
      } else {
        preview.style.display = 'none';
        removeBg.disabled = true;
      }
      result.style.display = 'none';
      outImg.style.display = 'none';
      resultControls.style.display = 'none';
    });

    function showLoading(msg) {
      loadText.textContent = msg || "Processing image...";
      loading.style.display = 'flex';
      document.body.style.overflow = 'hidden';
      document.querySelector('.main').style.display = 'none';
    }
    function hideLoading() {
      loading.style.display = 'none';
      document.body.style.overflow = '';
      document.querySelector('.main').style.display = 'flex';
    }
    function showToast(msg) {
      toast.textContent = msg;
      toast.style.display = 'block';
      setTimeout(() => toast.style.display = 'none', 2000);
    }
    async function process(endpoint) {
      if (!fileObj) return showToast("Select an image first.");
      showLoading();
      removeBg.disabled = true;
      try {
        const formData = new FormData();
        formData.append('image', fileObj);
        const res = await fetch(endpoint, { method: 'POST', body: formData });
        const data = await res.json();
        hideLoading();
        if (!res.ok || !data.success) return showToast(data.error || "Failed to process.");
        outImg.src = data.url;
        outImg.style.display = 'block';
        download.href = data.url;
        download.download = data.url.split('/').pop();
        resultControls.style.display = 'flex';
        result.style.display = 'block';
        formBox.style.display = 'none';
      } catch {
        hideLoading();
        showToast("Connection failed.");
      } finally {
        resetInput();
        fileObj = null;
      }
    }
    removeBg.addEventListener('click', () => process('/api/remove-bg'));
    resetBtn.addEventListener('click', () => {
      formBox.style.display = 'block';
      result.style.display = 'none';
      preview.style.display = 'none';
      removeBg.disabled = true;
      resetInput();
    });
  </script>
</body>
</html>